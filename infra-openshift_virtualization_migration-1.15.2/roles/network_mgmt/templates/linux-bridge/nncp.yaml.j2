apiVersion: nmstate.io/v1
kind: NodeNetworkConfigurationPolicy
metadata:
  name: {{ vswitch.name | infra.openshift_virtualization_migration.rfc1123(network_mgmt_nncp_name_prefix) }}
  annotations: 
    infra.openshift-virtualization-migration/source-switch: {{ vswitch.name }}
    infra.openshift-virtualization-migration/provider-hostname: {{ network_mgmt_vcenter_hostname }}
    infra.openshift-virtualization-migration/provider-type: vmware 
spec:
  desiredState:
    interfaces:
{% if not network_mgmt__port_is_existing_bond %}    
      - ipv4:
          enabled: false
        ipv6:
          enabled: false
        link-aggregation:
          mode: {{ network_mgmt_openshift_network_bond_mode }}
          port: {{ network_mgmt_openshift_node_network_ports }}
        mtu: {{ vswitch.mtu }}
        name: {{ (vswitch.name | infra.openshift_virtualization_migration.rfc1123(network_mgmt_nncp_name_prefix))[:12] }}-up
        state: up
        type: bond
{% endif %}
      - bridge:
          options:
            stp:
              enabled: false
          port:
{% if not network_mgmt_port_is_existing_bond %}  
            - name: {{ (vswitch.name | infra.openshift_virtualization_migration.rfc1123(network_mgmt_nncp_name_prefix))[:12]  }}-up
{% else %}
            - name: {{ network_mgmt_openshift_node_network_ports[0] }}
{% endif %}
        ipv4:
          enabled: false
        ipv6:
          enabled: false
        mtu: {{ vswitch.mtu }}
        name: {{ (vswitch.name | infra.openshift_virtualization_migration.rfc1123(network_mgmt_nncp_name_prefix))[:15] }}
        state: up
        type: linux-bridge
{% for port in network_mgmt_openshift_node_network_ports %}
      - ipv4:  
          enabled: false
        ipv6:
          enabled: false
        mtu: {{ vswitch.mtu }}
        name: {{ port }}
        state: up
        type: ethernet
{% endfor %}
  maxUnavailable: {{ network_mgmt_nncp_max_unavailable }} 
  nodeSelector:
    {{ network_mgmt_nncp_nodeselector }}

